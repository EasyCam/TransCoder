<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransCoder - 智能多语种翻译工具</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-translate"></i> TransCoder
            </span>
            
            <!-- 高级选项 -->
            <div class="d-flex align-items-center flex-wrap">
                <div class="form-check form-check-inline me-3">
                    <input class="form-check-input" type="checkbox" id="useVectorDB" checked>
                    <label class="form-check-label text-white" for="useVectorDB">
                        翻译记忆库
                    </label>
                </div>
                <div class="form-check form-check-inline me-3">
                    <input class="form-check-input" type="checkbox" id="useTerminology" checked>
                    <label class="form-check-label text-white" for="useTerminology">
                        术语库
                    </label>
                </div>
                <div class="me-3">
                    <label class="form-label text-white me-2 mb-0">模型:</label>
                    <select id="ollamaModel" class="form-select form-select-sm" style="width: auto; display: inline-block;">
                        <!-- 模型选项将由JavaScript动态加载 -->
                    </select>
                </div>
                <div>
                    <button class="btn btn-light btn-sm me-2" onclick="showTerminologyModal()">
                        <i class="bi bi-book"></i> 术语库
                    </button>
                    <button class="btn btn-light btn-sm" onclick="showVectorDBModal()">
                        <i class="bi bi-database"></i> 翻译记忆库
                    </button>
                    <a class="btn btn-outline-light btn-sm ms-2" href="/terminology">
                        <i class="bi bi-gear"></i> 术语管理
                    </a>
                    <a class="btn btn-outline-light btn-sm ms-1" href="/vector-db">
                        <i class="bi bi-tools"></i> 记忆库管理
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- 主翻译区域 -->
        <div class="row">
            <div class="col-md-5">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">源文本</h5>
                            <select id="sourceLang" class="form-select form-select-sm" style="width: auto;" aria-label="选择源语言">
                                <option value="auto">自动检测</option>
                                <option value="zh">中文</option>
                                <option value="en">English</option>
                                <option value="ja">日本語</option>
                                <option value="ko">한국어</option>
                                <option value="es">Español</option>
                                <option value="fr">Français</option>
                                <option value="de">Deutsch</option>
                                <option value="ru">Русский</option>
                                <option value="ar">العربية</option>
                                <option value="pt">Português</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <textarea id="sourceText" class="form-control" rows="15" 
                                placeholder="请输入要翻译的文本..." aria-label="输入要翻译的文本"></textarea>
                        <div class="mt-2 text-end">
                            <small class="text-muted">字数: <span id="charCount">0</span></small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-2 text-center d-flex align-items-center justify-content-center">
                <button id="translateBtn" class="btn btn-primary btn-lg" onclick="translateText()">
                    <i class="bi bi-arrow-right-circle"></i><br>翻译
                </button>
            </div>

            <div class="col-md-5">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">目标语言</h5>
                            <button class="btn btn-sm btn-success" onclick="addTargetLanguage()">
                                <i class="bi bi-plus"></i> 添加语言
                            </button>
                        </div>
                    </div>
                    <div class="card-body" id="targetLanguages">
                        <!-- 默认添加一个目标语言 -->
                        <div class="target-lang-item mb-3" data-lang="en">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <select class="form-select form-select-sm target-lang-select" style="width: auto;" aria-label="选择目标语言">
                                    <option value="zh">中文</option>
                                    <option value="en" selected>English</option>
                                    <option value="ja">日本語</option>
                                    <option value="ko">한국어</option>
                                    <option value="es">Español</option>
                                    <option value="fr">Français</option>
                                    <option value="de">Deutsch</option>
                                    <option value="ru">Русский</option>
                                    <option value="ar">العربية</option>
                                    <option value="pt">Português</option>
                                </select>
                                <button class="btn btn-sm btn-danger" onclick="removeTargetLanguage(this)" aria-label="删除此目标语言">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                            <textarea class="form-control translation-result" rows="5" readonly 
                                    placeholder="翻译结果将显示在这里..." aria-label="翻译结果"></textarea>
                            <div class="mt-2">
                                <button class="btn btn-sm btn-info" onclick="evaluateTranslation(this)">
                                    <i class="bi bi-speedometer2"></i> 评估质量
                                </button>
                                <button class="btn btn-sm btn-secondary" onclick="copyTranslation(this)">
                                    <i class="bi bi-clipboard"></i> 复制
                                </button>
                            </div>
                            <div class="evaluation-result mt-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 术语库模态框 -->
    <div class="modal fade" id="terminologyModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">术语库管理</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="关闭"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <h6>导入术语库</h6>
                        <input type="file" id="terminologyFile" class="form-control" 
                               accept=".csv,.xlsx,.tbx,.json" aria-label="选择术语库文件">
                        <button class="btn btn-primary mt-2" onclick="uploadTerminology()">
                            <i class="bi bi-upload"></i> 上传
                        </button>
                    </div>
                    <div class="mb-3">
                        <h6>导出术语库</h6>
                        <select id="exportFormat" class="form-select mb-2" aria-label="选择导出格式">
                            <option value="csv">CSV</option>
                            <option value="xlsx">Excel</option>
                            <option value="tbx">TBX</option>
                            <option value="json">JSON</option>
                        </select>
                        <button class="btn btn-success" onclick="exportTerminology()">
                            <i class="bi bi-download"></i> 导出
                        </button>
                    </div>
                    <div>
                        <h6>添加新术语</h6>
                        <input type="text" id="newTerm" class="form-control mb-2" placeholder="术语" aria-label="输入新术语">
                        <div id="termTranslations">
                            <div class="row mb-2">
                                <div class="col-3">
                                    <select class="form-select term-lang" aria-label="选择术语语言">
                                        <option value="zh">中文</option>
                                        <option value="en">English</option>
                                        <option value="ja">日本語</option>
                                    </select>
                                </div>
                                <div class="col-9">
                                    <input type="text" class="form-control term-translation" 
                                           placeholder="翻译" aria-label="输入术语翻译">
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-secondary" onclick="addTermTranslation()">
                            <i class="bi bi-plus"></i> 添加语言
                        </button>
                        <button class="btn btn-primary" onclick="saveTerm()">
                            <i class="bi bi-save"></i> 保存术语
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 向量数据库模态框 -->
    <div class="modal fade" id="vectorDBModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">翻译记忆库管理</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="关闭"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <h6>导入TMX文件</h6>
                        <input type="file" id="tmxFile" class="form-control" accept=".tmx" aria-label="选择TMX文件">
                        <button class="btn btn-primary mt-2" onclick="uploadTMX()">
                            <i class="bi bi-upload"></i> 上传
                        </button>
                    </div>
                    <div class="mb-3">
                        <h6>导出翻译记忆</h6>
                        <button class="btn btn-success" onclick="exportTMX()">
                            <i class="bi bi-download"></i> 导出TMX
                        </button>
                    </div>
                    <div>
                        <h6>添加当前翻译到记忆库</h6>
                        <button class="btn btn-primary" onclick="addToVectorDB()">
                            <i class="bi bi-plus-circle"></i> 添加到记忆库
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html> 